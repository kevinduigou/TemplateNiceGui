"""Unit tests for create user command."""

from result import Err, Ok

from {{ project_slug }}.application.commands.create_user import (
    CreateUserCommand,
    execute_create_user,
)


def test_create_user_success() -> None:
    """Test successful user creation."""
    command = CreateUserCommand(
        username="testuser",
        email_string="test@example.com",
    )
    result = execute_create_user(command)

    match result:
        case Ok(user):
            assert user.username == "testuser"
            assert user.email == "test@example.com"
            assert user.is_active is True
        case Err(_):
            assert False, "User creation should succeed"


def test_create_user_invalid_email() -> None:
    """Test user creation fails with invalid email."""
    command = CreateUserCommand(
        username="testuser",
        email_string="invalid-email",
    )
    result = execute_create_user(command)

    assert result == Err("Invalid email: Email must contain @ symbol")


def test_create_user_empty_email() -> None:
    """Test user creation fails with empty email."""
    command = CreateUserCommand(
        username="testuser",
        email_string="",
    )
    result = execute_create_user(command)

    assert result == Err("Invalid email: Email cannot be empty")


def test_create_user_email_without_domain() -> None:
    """Test user creation fails with email without domain."""
    command = CreateUserCommand(
        username="testuser",
        email_string="test@",
    )
    result = execute_create_user(command)

    assert result == Err("Invalid email: Email domain part cannot be empty")
