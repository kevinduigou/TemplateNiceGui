# Enable required Google Cloud APIs
# These must be enabled before creating resources that depend on them

resource "google_project_service" "artifactregistry" {
  project = var.project_id
  service = "artifactregistry.googleapis.com"

  disable_on_destroy = false
}

resource "google_project_service" "container" {
  project = var.project_id
  service = "container.googleapis.com"

  disable_on_destroy = false
}

resource "google_project_service" "compute" {
  project = var.project_id
  service = "compute.googleapis.com"

  disable_on_destroy = false
}

# Add a small delay after enabling APIs to allow propagation
resource "time_sleep" "wait_for_apis" {
  depends_on = [
    google_project_service.artifactregistry,
    google_project_service.container,
    google_project_service.compute,
  ]

  create_duration = "30s"
}
