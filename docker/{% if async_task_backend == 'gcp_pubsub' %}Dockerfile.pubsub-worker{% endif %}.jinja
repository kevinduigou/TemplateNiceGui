# Dockerfile for GCP Pub/Sub Worker
FROM python:{{ python_version }}-slim

WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# Copy project files
COPY pyproject.toml ./
COPY src/ ./src/

# Install uv for faster dependency installation
RUN pip install --no-cache-dir uv

# Install dependencies
RUN uv pip install --system --no-cache -e .

# Set environment variables
ENV PYTHONUNBUFFERED=1
ENV GOOGLE_CLOUD_PROJECT={{ project_slug }}

# Run the Pub/Sub worker
CMD ["python", "-m", "{{ project_slug }}.infrastructure.pubsub_client.worker"]
